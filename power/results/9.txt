BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%almond%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 |  268960552.52307
 ALGERIA                   |   1997 | 453083378.029824
 ALGERIA                   |   1996 | 457910665.309529
 ALGERIA                   |   1995 | 459946915.094477
 ALGERIA                   |   1994 | 449905268.455416
 ALGERIA                   |   1993 | 460069606.252147
 ALGERIA                   |   1992 | 451841737.835348
 ARGENTINA                 |   1998 | 275262712.573973
 ARGENTINA                 |   1997 | 471431908.616092
 ARGENTINA                 |   1996 | 473613492.280366
 ARGENTINA                 |   1995 | 467026566.839895
 ARGENTINA                 |   1994 | 472585124.809756
 ARGENTINA                 |   1993 | 477284060.596333
 ARGENTINA                 |   1992 | 473551810.997354
 BRAZIL                    |   1998 | 273147471.711941
 BRAZIL                    |   1997 | 467355601.910217
 BRAZIL                    |   1996 | 452260087.876284
 BRAZIL                    |   1995 | 461306365.491578
 BRAZIL                    |   1994 | 462077140.510926
 BRAZIL                    |   1993 | 458391106.006251
 BRAZIL                    |   1992 | 463297896.272617
 CANADA                    |   1998 | 286096054.032943
 CANADA                    |   1997 |  484994316.35738
 CANADA                    |   1996 | 474090460.173659
 CANADA                    |   1995 | 468808550.217492
 CANADA                    |   1994 | 474194082.344662
 CANADA                    |   1993 | 475581484.640726
 CANADA                    |   1992 | 474320035.271326
 CHINA                     |   1998 | 274048817.165997
 CHINA                     |   1997 | 450241779.481356
 CHINA                     |   1996 | 454952370.246419
 CHINA                     |   1995 | 463658864.970626
 CHINA                     |   1994 | 459948371.227553
 CHINA                     |   1993 | 463893377.887894
 CHINA                     |   1992 |  463792884.53197
 EGYPT                     |   1998 | 271629901.885868
 EGYPT                     |   1997 | 464503755.279267
 EGYPT                     |   1996 | 466567779.241494
 EGYPT                     |   1995 | 469330470.071467
 EGYPT                     |   1994 | 466802644.160353
 EGYPT                     |   1993 | 459331586.003503
 EGYPT                     |   1992 | 463449247.639499
 ETHIOPIA                  |   1998 | 267387028.395019
 ETHIOPIA                  |   1997 | 458519492.766652
 ETHIOPIA                  |   1996 | 456447221.056693
 ETHIOPIA                  |   1995 | 454843074.458578
 ETHIOPIA                  |   1994 | 460706339.472196
 ETHIOPIA                  |   1993 | 463180573.462475
 ETHIOPIA                  |   1992 | 459305423.616385
 FRANCE                    |   1998 | 269607335.159574
 FRANCE                    |   1997 | 452683551.881039
 FRANCE                    |   1996 | 458744996.734258
 FRANCE                    |   1995 | 453598531.833118
 FRANCE                    |   1994 | 454713909.535127
 FRANCE                    |   1993 | 450550423.886207
 FRANCE                    |   1992 | 453825535.511654
 GERMANY                   |   1998 | 279142547.489788
 GERMANY                   |   1997 | 493171119.947162
 GERMANY                   |   1996 | 484611533.484016
 GERMANY                   |   1995 | 481552804.540296
 GERMANY                   |   1994 |  481774864.13107
 GERMANY                   |   1993 | 483596706.655459
 GERMANY                   |   1992 | 481834806.516157
 INDIA                     |   1998 | 272610653.873076
 INDIA                     |   1997 | 472488711.640737
 INDIA                     |   1996 | 474135782.148203
 INDIA                     |   1995 | 465228410.101331
 INDIA                     |   1994 | 473127010.653168
 INDIA                     |   1993 | 473519925.919688
 INDIA                     |   1992 | 467145058.521984
 INDONESIA                 |   1998 | 266352397.431334
 INDONESIA                 |   1997 | 462747922.836566
 INDONESIA                 |   1996 | 459019102.832201
 INDONESIA                 |   1995 | 463661452.735214
 INDONESIA                 |   1994 | 456977848.329656
 INDONESIA                 |   1993 | 463690575.719548
 INDONESIA                 |   1992 | 470134403.673215
 IRAN                      |   1998 |    270499900.659
 IRAN                      |   1997 | 468793935.705507
 IRAN                      |   1996 | 468072477.608869
 IRAN                      |   1995 | 468312610.434151
 IRAN                      |   1994 | 470548757.121424
 IRAN                      |   1993 | 466796352.459359
 IRAN                      |   1992 | 469075920.193596
 IRAQ                      |   1998 | 274649182.009319
 IRAQ                      |   1997 | 479071147.366281
 IRAQ                      |   1996 | 469894160.227564
 IRAQ                      |   1995 | 472865377.295982
 IRAQ                      |   1994 | 475130706.831486
 IRAQ                      |   1993 |  477504221.65539
 IRAQ                      |   1992 | 472330341.183125
 JAPAN                     |   1998 | 269901488.764462
 JAPAN                     |   1997 | 467971163.170464
 JAPAN                     |   1996 | 462402102.828295
 JAPAN                     |   1995 | 466458905.722818
 JAPAN                     |   1994 | 464390614.401024
 JAPAN                     |   1993 | 462032495.519004
 JAPAN                     |   1992 | 465068212.239444
 JORDAN                    |   1998 | 273955423.913686
 JORDAN                    |   1997 | 462725749.542837
 JORDAN                    |   1996 | 461683246.001118
 JORDAN                    |   1995 | 465687391.029328
 JORDAN                    |   1994 | 462556223.403393
 JORDAN                    |   1993 |  466681749.47631
 JORDAN                    |   1992 | 452995104.264714
 KENYA                     |   1998 | 271241067.170224
 KENYA                     |   1997 |   466593393.0772
 KENYA                     |   1996 | 471237438.538357
 KENYA                     |   1995 | 462355214.057597
 KENYA                     |   1994 | 464324657.873181
 KENYA                     |   1993 | 464309848.456379
 KENYA                     |   1992 | 472996856.613382
 MOROCCO                   |   1998 | 271476378.489431
 MOROCCO                   |   1997 | 471366719.781162
 MOROCCO                   |   1996 | 467672913.624227
 MOROCCO                   |   1995 |  469317765.22512
 MOROCCO                   |   1994 | 461266778.752451
 MOROCCO                   |   1993 | 466085930.769496
 MOROCCO                   |   1992 | 473300308.097177
 MOZAMBIQUE                |   1998 | 264822470.736024
 MOZAMBIQUE                |   1997 |  457016313.31853
 MOZAMBIQUE                |   1996 | 448932417.417447
 MOZAMBIQUE                |   1995 | 464433352.465626
 MOZAMBIQUE                |   1994 | 454902282.347624
 MOZAMBIQUE                |   1993 | 455848246.651576
 MOZAMBIQUE                |   1992 | 452409475.233524
 PERU                      |   1998 | 280193649.964666
 PERU                      |   1997 | 464170833.898886
 PERU                      |   1996 |  475180330.55305
 PERU                      |   1995 | 476055603.716147
 PERU                      |   1994 | 464906380.967346
 PERU                      |   1993 |  468071782.58463
 PERU                      |   1992 | 484474638.625358
 ROMANIA                   |   1998 | 273552277.441588
 ROMANIA                   |   1997 | 468851938.584798
 ROMANIA                   |   1996 | 471348895.543315
 ROMANIA                   |   1995 | 460309645.492385
 ROMANIA                   |   1994 | 468788801.880478
 ROMANIA                   |   1993 | 470178732.721732
 ROMANIA                   |   1992 |  471283420.88834
 RUSSIA                    |   1998 | 271509329.006402
 RUSSIA                    |   1997 | 466306793.902555
 RUSSIA                    |   1996 | 466650289.318424
 RUSSIA                    |   1995 | 463573303.623101
 RUSSIA                    |   1994 | 466534530.503201
 RUSSIA                    |   1993 | 465226016.073187
 RUSSIA                    |   1992 | 468516969.737742
 SAUDI ARABIA              |   1998 | 272067467.149381
 SAUDI ARABIA              |   1997 | 473337920.655312
 SAUDI ARABIA              |   1996 | 466974922.131854
 SAUDI ARABIA              |   1995 | 472101247.845704
 SAUDI ARABIA              |   1994 | 474207718.186173
 SAUDI ARABIA              |   1993 | 478005547.656265
 SAUDI ARABIA              |   1992 | 473723101.487734
 UNITED KINGDOM            |   1998 | 272525994.984148
 UNITED KINGDOM            |   1997 | 463169965.001032
 UNITED KINGDOM            |   1996 | 461755677.142312
 UNITED KINGDOM            |   1995 |  457603731.03947
 UNITED KINGDOM            |   1994 | 460506816.810004
 UNITED KINGDOM            |   1993 | 458518739.143021
 UNITED KINGDOM            |   1992 | 469208164.498344
 UNITED STATES             |   1998 |  274645526.78442
 UNITED STATES             |   1997 | 481455440.670417
 UNITED STATES             |   1996 | 481241324.381116
 UNITED STATES             |   1995 | 476539943.263165
 UNITED STATES             |   1994 | 479645220.918303
 UNITED STATES             |   1993 |  483724639.70196
 UNITED STATES             |   1992 | 480554099.921073
 VIETNAM                   |   1998 | 267298986.243139
 VIETNAM                   |   1997 | 459023306.854921
 VIETNAM                   |   1996 | 464813494.168492
 VIETNAM                   |   1995 | 461298521.786191
 VIETNAM                   |   1994 | 463586046.872859
 VIETNAM                   |   1993 | 458942581.563266
 VIETNAM                   |   1992 | 467547408.314828
(175 rows)

COMMIT;
COMMIT
