BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%peach%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 261361675.485437
 ALGERIA                   |   1997 | 452594853.511737
 ALGERIA                   |   1996 | 456770932.369797
 ALGERIA                   |   1995 | 451981302.314075
 ALGERIA                   |   1994 | 451085509.213651
 ALGERIA                   |   1993 | 457606821.529816
 ALGERIA                   |   1992 | 456018743.155693
 ARGENTINA                 |   1998 |  280940008.22862
 ARGENTINA                 |   1997 | 471265052.568848
 ARGENTINA                 |   1996 | 474510305.932471
 ARGENTINA                 |   1995 | 471287876.862557
 ARGENTINA                 |   1994 | 466762764.196962
 ARGENTINA                 |   1993 | 468963672.473519
 ARGENTINA                 |   1992 | 475581540.567025
 BRAZIL                    |   1998 | 270053079.075486
 BRAZIL                    |   1997 | 469888286.441123
 BRAZIL                    |   1996 | 468322324.422286
 BRAZIL                    |   1995 | 461713112.900909
 BRAZIL                    |   1994 | 467267277.355011
 BRAZIL                    |   1993 | 466286237.484434
 BRAZIL                    |   1992 | 471075750.485702
 CANADA                    |   1998 | 267402660.672695
 CANADA                    |   1997 | 467437059.929735
 CANADA                    |   1996 | 474286178.801757
 CANADA                    |   1995 | 467009587.697229
 CANADA                    |   1994 |  478109160.14765
 CANADA                    |   1993 | 465623034.590692
 CANADA                    |   1992 |  468267366.37996
 CHINA                     |   1998 | 281507686.874141
 CHINA                     |   1997 | 472741948.600427
 CHINA                     |   1996 | 474113127.576237
 CHINA                     |   1995 |  469860056.18497
 CHINA                     |   1994 | 465199496.480766
 CHINA                     |   1993 |  482071601.00235
 CHINA                     |   1992 | 474384325.592534
 EGYPT                     |   1998 | 281244792.612566
 EGYPT                     |   1997 | 473140155.046908
 EGYPT                     |   1996 | 475718788.611612
 EGYPT                     |   1995 |  466463403.66324
 EGYPT                     |   1994 |  478771443.50341
 EGYPT                     |   1993 | 469725227.235408
 EGYPT                     |   1992 | 474424162.930447
 ETHIOPIA                  |   1998 | 264341955.437409
 ETHIOPIA                  |   1997 | 448372731.423773
 ETHIOPIA                  |   1996 | 440252796.971726
 ETHIOPIA                  |   1995 | 446241474.946241
 ETHIOPIA                  |   1994 | 454961988.543703
 ETHIOPIA                  |   1993 | 448598124.368261
 ETHIOPIA                  |   1992 | 449569251.816621
 FRANCE                    |   1998 | 271891661.149807
 FRANCE                    |   1997 | 450297487.318643
 FRANCE                    |   1996 | 461098513.223367
 FRANCE                    |   1995 | 465015600.011779
 FRANCE                    |   1994 | 458025774.635845
 FRANCE                    |   1993 | 462350545.831403
 FRANCE                    |   1992 | 462549336.533168
 GERMANY                   |   1998 | 273410670.827173
 GERMANY                   |   1997 | 477022077.047245
 GERMANY                   |   1996 | 472473356.869466
 GERMANY                   |   1995 |  479374139.08979
 GERMANY                   |   1994 | 479658742.428272
 GERMANY                   |   1993 | 477754138.221468
 GERMANY                   |   1992 | 479508382.034582
 INDIA                     |   1998 | 275741713.553345
 INDIA                     |   1997 | 469078695.875511
 INDIA                     |   1996 | 476747932.491956
 INDIA                     |   1995 | 487327435.444828
 INDIA                     |   1994 |  476749452.46456
 INDIA                     |   1993 | 475238762.322574
 INDIA                     |   1992 | 480259395.882651
 INDONESIA                 |   1998 |  275780580.46348
 INDONESIA                 |   1997 | 457194759.585177
 INDONESIA                 |   1996 | 469112467.226196
 INDONESIA                 |   1995 | 474317690.100884
 INDONESIA                 |   1994 | 467490751.302118
 INDONESIA                 |   1993 | 463457398.210838
 INDONESIA                 |   1992 | 468749433.431084
 IRAN                      |   1998 | 271177241.480799
 IRAN                      |   1997 |  461580825.77511
 IRAN                      |   1996 | 467727190.440511
 IRAN                      |   1995 | 475732761.607285
 IRAN                      |   1994 | 469958877.353545
 IRAN                      |   1993 | 470330330.158881
 IRAN                      |   1992 | 479259593.038684
 IRAQ                      |   1998 | 275688264.816898
 IRAQ                      |   1997 | 468410002.714401
 IRAQ                      |   1996 | 478845577.093844
 IRAQ                      |   1995 | 470169114.184207
 IRAQ                      |   1994 | 470132787.659567
 IRAQ                      |   1993 | 469057075.338644
 IRAQ                      |   1992 | 478136446.214163
 JAPAN                     |   1998 | 265125600.205763
 JAPAN                     |   1997 | 451195265.613851
 JAPAN                     |   1996 | 464931546.846476
 JAPAN                     |   1995 |  452241511.91196
 JAPAN                     |   1994 | 458831212.275018
 JAPAN                     |   1993 | 462669087.825145
 JAPAN                     |   1992 | 449214423.058102
 JORDAN                    |   1998 | 261858392.361823
 JORDAN                    |   1997 | 463790651.383592
 JORDAN                    |   1996 |  460767666.39167
 JORDAN                    |   1995 | 452152873.291931
 JORDAN                    |   1994 | 462960041.998007
 JORDAN                    |   1993 | 451667698.739037
 JORDAN                    |   1992 | 456940032.850253
 KENYA                     |   1998 | 274654039.869931
 KENYA                     |   1997 | 464548530.130263
 KENYA                     |   1996 | 466595937.859567
 KENYA                     |   1995 | 464543051.062823
 KENYA                     |   1994 | 469675713.493996
 KENYA                     |   1993 | 470236908.389539
 KENYA                     |   1992 | 463634811.923759
 MOROCCO                   |   1998 |   271410542.6989
 MOROCCO                   |   1997 | 468950232.981844
 MOROCCO                   |   1996 | 471023089.381146
 MOROCCO                   |   1995 | 468063189.239712
 MOROCCO                   |   1994 | 465853178.914965
 MOROCCO                   |   1993 | 465254176.374184
 MOROCCO                   |   1992 | 468122990.335171
 MOZAMBIQUE                |   1998 | 264866991.891762
 MOZAMBIQUE                |   1997 | 462717102.489542
 MOZAMBIQUE                |   1996 | 461653530.567581
 MOZAMBIQUE                |   1995 | 457281054.700026
 MOZAMBIQUE                |   1994 | 461393401.328616
 MOZAMBIQUE                |   1993 | 464511056.238593
 MOZAMBIQUE                |   1992 | 453035540.309827
 PERU                      |   1998 | 278743460.081146
 PERU                      |   1997 | 464906104.737401
 PERU                      |   1996 |  457941364.90823
 PERU                      |   1995 | 458002152.309548
 PERU                      |   1994 | 461272477.377916
 PERU                      |   1993 | 460798256.444068
 PERU                      |   1992 | 462462472.196586
 ROMANIA                   |   1998 |   273976522.7258
 ROMANIA                   |   1997 | 466860135.809204
 ROMANIA                   |   1996 | 465943290.505269
 ROMANIA                   |   1995 | 460476877.012234
 ROMANIA                   |   1994 | 473046420.168162
 ROMANIA                   |   1993 | 470412459.929254
 ROMANIA                   |   1992 | 468318374.449576
 RUSSIA                    |   1998 | 268875407.816914
 RUSSIA                    |   1997 | 460805117.278507
 RUSSIA                    |   1996 | 463698291.434318
 RUSSIA                    |   1995 | 455303019.651011
 RUSSIA                    |   1994 | 465422648.686622
 RUSSIA                    |   1993 | 465292550.049939
 RUSSIA                    |   1992 | 461045730.440675
 SAUDI ARABIA              |   1998 | 275607858.236776
 SAUDI ARABIA              |   1997 | 465747606.669931
 SAUDI ARABIA              |   1996 | 468324359.412951
 SAUDI ARABIA              |   1995 |  463465008.95718
 SAUDI ARABIA              |   1994 | 464381891.201452
 SAUDI ARABIA              |   1993 | 463581803.998828
 SAUDI ARABIA              |   1992 | 471794551.225217
 UNITED KINGDOM            |   1998 | 269364122.644667
 UNITED KINGDOM            |   1997 | 457298766.559349
 UNITED KINGDOM            |   1996 | 459363675.127045
 UNITED KINGDOM            |   1995 | 448056231.945399
 UNITED KINGDOM            |   1994 |  451124932.77734
 UNITED KINGDOM            |   1993 |  465816347.80543
 UNITED KINGDOM            |   1992 | 462459495.299369
 UNITED STATES             |   1998 | 270358224.657128
 UNITED STATES             |   1997 | 459013680.906988
 UNITED STATES             |   1996 | 459117224.179375
 UNITED STATES             |   1995 | 462747489.768197
 UNITED STATES             |   1994 | 469982043.903838
 UNITED STATES             |   1993 | 469674210.090083
 UNITED STATES             |   1992 | 465224021.430213
 VIETNAM                   |   1998 | 276986598.134954
 VIETNAM                   |   1997 | 474002413.087906
 VIETNAM                   |   1996 | 474397520.200268
 VIETNAM                   |   1995 | 460861744.276195
 VIETNAM                   |   1994 | 471140816.662256
 VIETNAM                   |   1993 | 469098131.843639
 VIETNAM                   |   1992 | 479067453.484806
(175 rows)

COMMIT;
COMMIT
